<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheCoolVision - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pico.colors.min.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pico.min.css') }}" />
</head>

<body>
    <div class="container-fluid">

        <div class="grid">
            <div class="container video-container" onclick="takePhoto()">
                <video class="video-feed" id="webcamVideo" autoplay></video>
                <div class="countdown-overlay"></div>
                <button class="overlay photo-button-overlay">Take a photo ðŸ“¸</button>
            </div>

            <div class="button-column mhd-buttons">

                <div class="container">
                    <button class="change-mhd decrease-mhd" id="decrease-days-button" onclick="decrease('days-button')">-</button>
                    <button class="btn-mhd" id="days-button" onclick="selectButton(this.id)">3 Tage</button>
                    <button class="change-mhd increase-mhd" id="increase-days-button" onclick="increase('days-button')">+</button>
                </div>
                <div class="container">
                    <button class="change-mhd decrease-mhd" id="decrease-days-button" onclick="decrease('weeks-button')">-</button>
                    <button class="btn-mhd" id="weeks-button" onclick="selectButton(this.id)">1 Woche</button>
                    <button class="change-mhd increase-mhd" id="increase-days-button" onclick="increase('weeks-button')">+</button>
                </div>
                <div class="container">
                    <button class="change-mhd decrease-mhd" id="decrease-days-button" onclick="decrease('months-button')">-</button>
                    <button class="btn-mhd" id="months-button" onclick="selectButton(this.id)">1 Monat</button>
                    <button class="change-mhd increase-mhd" id="increase-days-button" onclick="increase('months-button')">+</button>
                </div>
            </div>
            
        </div>

        <div class="button-grid names-grid">
            {% for name in names %}
                <button class="btn-pers" id="{{ name }}" onclick="selectButton(this.id)">{{ name }}</button>
            {% endfor %}
        </div>

        <div class="button-row general-controls">
            <button class="pico-background-red-350 big-button-action" onclick="abbrechen()">Abbrechen</button>
            <button class="pico-background-green-350 big-button-action" onclick="hinzufuegen()">HinzufÃ¼gen</button>
            <button class="pico-background-amber-250 big-button-action" onclick="if (document.querySelector('.btn-pers.selected')) { window.location.href='/remove_product/' + document.querySelector('.btn-pers.selected').id }">Rausnehmen</button>
        </div>
    </div>

    <footer>
        <nav class="navbar-bottom">
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>

            </ul>

            <div class="right">
                <fieldset>
                
                    <label>
                        â˜¼&nbsp;&nbsp;
                        <input name="opt-in" id="theme-toggle" type="checkbox" role="switch" checked/>
                        ðŸŒ™
                    </label>
                
                </fieldset>
            </div>

        </nav>
    </footer>
    

    <script>
        function selectButton(selectedId) {
            // Check if the button is already selected
            var button = document.getElementById(selectedId);
            var isSelected = button.classList.contains('selected');
            var buttonClass = button.classList[0];
            
    
            // Deselect all buttons if the button is already selected
            if (isSelected) {
                button.classList.remove('selected');
            } else {
                // Deselect all buttons
                document.querySelectorAll('.' + buttonClass).forEach(button => {
                    button.classList.remove('selected');
                });
    
                // Select the clicked button
                button.classList.add('selected');
            }
        }

        function hinzufuegen() {
            var selectedButtons = document.querySelectorAll('.selected');
            var selectedButtonsText = [];
            var amount, unit, person;

            selectedButtons.forEach(button => {
                if (button.classList.contains('btn-mhd')) {
                    unit = getUnitSelectedButton(button.id);
                    amount = getAmountSelectedButton(button.id);
                } else if (button.classList.contains('btn-pers')) {
                    person = button.innerText;
                }
            });

            console.log(amount, unit, person);
        }

        function abbrechen() {
            document.querySelectorAll('.selected').forEach(button => {
                button.classList.remove('selected');
            });
        }

        // Function to increase the amount
        function increase(buttonId) {
            const button = document.getElementById(buttonId);
            if (! button.classList.contains('selected')) {
                selectButton(buttonId);
            }
            const buttonTexts = button.innerText.split(' ')
            let amount = parseInt(buttonTexts[0]);
            amount++;
            button.innerText = `${amount} ${buttonTexts[1]}`;
            checkGrammer(buttonId);
        }

        // Function to decrease the amount
        function decrease(buttonId) {
            const button = document.getElementById(buttonId);
            if (! button.classList.contains('selected')) {
                selectButton(buttonId);
            }
            const buttonTexts = button.innerText.split(' ')
            let amount = parseInt(buttonTexts[0]);
            if (amount > 1) {  // Ensure amount do not go below 1
                amount--;
            }
            button.innerText = `${amount} ${buttonTexts[1]}`;
            checkGrammer(buttonId);
        }

        function checkGrammer(buttonID){
            var button = document.getElementById(buttonID);
            var buttonText = button.innerText;
            var buttonTexts = buttonText.split(' ');
            var amount = parseInt(buttonTexts[0]);
            var unit = buttonTexts[1];
            if (amount > 1) {
                if (unit.includes("Tag")) {
                    unit = "Tage";
                } else if (unit.includes("Woche")) {
                    unit = "Wochen";
                } else if (unit.includes("Monat")) {
                    unit = "Monate";
                }
                button.innerText = `${amount} ${unit}`;
            } else {
                if (unit.includes("Tage")) {
                    unit = "Tag";
                } else if (unit.includes("Wochen")) {
                    unit = "Woche";
                } else if (unit.includes("Monate")) {
                    unit = "Monat";
                }
                button.innerText = `${amount} ${unit}`;
            }
        }

        function getAmountSelectedButton(buttonId) {
            const button = document.getElementById(buttonId);
            const buttonTexts = button.innerText.split(' ')
            return parseInt(buttonTexts[0]);
        }

        function getUnitSelectedButton(buttonId) {
            const button = document.getElementById(buttonId);
            const buttonTexts = button.innerText.split(' ')
            return buttonTexts[1];
        }

        function takePhoto() {
            var overlay = document.querySelector(".countdown-overlay");
            var countdown = 3;
            var countdownInterval = setInterval(function() {
                if (countdown === 0) {
                    console.log("Take the photo!");
                    overlay.innerText = "";
                    clearInterval(countdownInterval);
                } else {
                    overlay.innerText = countdown;
                    countdown--;
                }
            }, 700);
        }


        // Get the current theme from local storage or default to 'light'
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);

        // Set the initial state of the toggle switch
        const toggleSwitch = document.getElementById('theme-toggle');
        if (currentTheme === 'dark') {
            toggleSwitch.checked = true;
        }

        // Add an event listener to the toggle switch
        toggleSwitch.addEventListener('change', function() {
            if (toggleSwitch.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });
        
        </script>
        
        <script src="{{ url_for('static', filename='js/send_video.js') }}"></script>
    </body>

    </html>